{% extends 'memberaudit/base.html' %}
{% load i18n %}
{% load static %}
{% load humanize %}
{% load evelinks %}

{% block details %}

<div class="panel panel-default">
    <div class="panel-body">

        <div class="rows">

            <div class="col-md-2">
                <img src="{{ character|character_portrait_url:128 }}" />
            </div>

            <div class="col-md-3">
                <dl class="dl-horizontal">
                    <dt>Character</dt>
                    <dd>{{ character.character_name}}</dd>
                    <dt>Corporation</dt>
                    <dd>{{ character_details.corporation }}</dd>
                    <dt>Alliance</dt>
                    <dd>{{ character_details.alliance|default:"-" }}</dd>
                    <dt>Faction</dt>
                    <dd>{{ character_details.faction|default:"-" }}</dd>
                </dl>
            </div>

            <div class="col-md-3">
                <dl class="dl-horizontal">
                    <dt>Born</dt>
                    <dd>{{ character_details.birthday|naturalday }}</dd>
                    <dt>Skillpoints</dt>
                    <dd>{{ character.corporation_name }}</dd>
                    <dt>Wallet</dt>
                    <dd>{{ wallet_balance|intcomma }}</dd>
                    <dt>Sec. Status</dt>
                    <dd>{{ character_details.security_status|floatformat|default:"-" }}</dd>
                </dl>
            </div>

            <div class="col-md-3">
                <dl class="dl-horizontal">
                    <dt>System</dt>
                    <dd>
                        <div id="div_location">Loading...</div>
                    </dd>
                    <dt>Location</dt>
                    <dd>{{ character.corporation_name }}</dd>
                    <dt>Race</dt>
                    <dd>{{ character_details.eve_bloodline.eve_race }}</dd>
                    <dt>Achestry</dt>
                    <dd>{{ character_details.eve_bloodline }}</dd>
                </dl>
            </div>

        </div>

    </div>
</div>

<div class="panel panel-default">
    <div class="panel-body">
        <div>
            <!-- Nav tabs -->
            <ul class="nav nav-tabs" role="tablist">
                <li role="presentation">
                    <a href="#bio" aria-controls="bio" role="tab" data-toggle="tab">Bio</a>
                </li>
                <li role="presentation">
                    <a href="#history" aria-controls="history" role="tab" data-toggle="tab">Corporation History</a>
                </li>
                <li role="presentation" class="disabled">
                    <a href="#clones" aria-controls="clones" role="tab" data-toggle="tab">Clones</a>
                </li>
                <li role="presentation">
                    <a href="#skills" aria-controls="skills" role="tab" data-toggle="tab">Skills</a>
                </li>
                <li role="presentation" class="disabled">
                    <a href="#skillqueue" aria-controls="skillqueue" role="tab" data-toggle="tab">Skillqueue</a>
                </li>
                <li role="presentation" class="disabled">
                    <a href="#mail" aria-controls="mail" role="tab" data-toggle="tab">Mail</a>
                </li>
                <li role="presentation" class="active">
                    <a href="#wallet" aria-controls="wallet" role="tab" data-toggle="tab">Wallet</a>
                </li>
                <li role="presentation" class="disabled"><a href="#contracts" aria-controls="contracts" role="tab"
                        data-toggle="tab">Contracts</a></li>
                <li role="presentation" class="disabled"><a href="#contacts" aria-controls="contacts" role="tab"
                        data-toggle="tab">Contacts</a></li>
                <li role="presentation" class="disabled"><a href="#assets" aria-controls="assets" role="tab"
                        data-toggle="tab">Assets</a></li>
            </ul>
            <br>

            <!-- Tab panes -->
            <div class="tab-content">

                <div role="tabpanel" class="tab-pane" id="bio">
                    {{ character_details.description_plain|default:"-" }}
                </div>

                <div role="tabpanel" class="tab-pane" id="history">
                    <dl class="dl-horizontal">
                        {% for entry in corporation_history %}
                        <dt>{{ entry.corporation_html }}</dt>
                        <dd>{{ entry.start_date|naturalday }} - {{ entry.end_date|naturalday }}</dd>
                        {% endfor %}
                    </dl>
                </div>

                <div role="tabpanel" class="tab-pane" id="clones">TBD</div>

                <div role="tabpanel" class="tab-pane" id="skills">
                    <div class="table-responsive">
                        <table class="table table-striped" id="tab_skills" style="width:100%;">
                            <thead>
                                <tr>
                                    <th>Group</th>
                                    <th>Skill</th>
                                    <th>Level</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div role="tabpanel" class="tab-pane" id="skillqueue">TBD</div>
                <div role="tabpanel" class="tab-pane" id="mail">TBD</div>
                <div role="tabpanel" class="tab-pane active" id="wallet">
                    <div class="table-responsive">
                        <table class="table" id="tab_wallet" style="width:100%;">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th>First party</th>
                                    <th>Second party</th>
                                    <th>Amount</th>
                                    <th>Balance</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane" id="contracts">TBD</div>
                <div role="tabpanel" class="tab-pane" id="contacts">TBD</div>
                <div role="tabpanel" class="tab-pane" id="assets">TBD</div>
            </div>
        </div>
    </div>
</div>


{% endblock details %}

{% block extra_javascript %}
    {% include 'bundles/datatables-js.html' %}
    <script type="application/javascript"
        src="https://cdn.datatables.net/rowgroup/1.1.2/js/dataTables.rowGroup.min.js"></script>
    <script type="application/javascript">
        $(document).ready(function () {
            $("#div_location").load(
                "{% url 'memberaudit:character_location_data' owner_pk %}"
            );

            $('#tab_skills').DataTable({
                ajax: {
                    url: "{% url 'memberaudit:character_skills_data' owner_pk %}",
                    dataSrc: '',
                    cache: false
                },
                columns: [
                    { data: 'group' },
                    { data: 'skill' },
                    { data: 'level' },
                ],
                order: [[0, "asc"], [1, "asc"]],
                rowGroup: {
                    dataSrc: 'group',
                    className: 'table-group'
                },
                columnDefs: [
                    { "visible": false, "targets": [0] }
                ],    
                createdRow: function( row, data, dataIndex ) 
                {
                    if (data[1]) {
                        $(row).addClass('danger');
                    }                
                }  
            });

            $('#tab_wallet').DataTable({
                ajax: {
                    url: "{% url 'memberaudit:character_wallet_journal_data' owner_pk %}",
                    dataSrc: '',
                    cache: false
                },
                columns: [
                    { data: 'date' },
                    { data: 'ref_type' },
                    { data: 'first_party' },
                    { data: 'second_party' },
                    { data: 'amount' },
                    { data: 'balance' },
                    { data: 'description' },
                ],
                order: [[0, "desc"]],
            });
        });
    </script>
{% endblock extra_javascript %}

{% block extra_css %}
    {% include 'bundles/datatables-css.html' %}
    <link rel="stylesheet" href="https://cdn.datatables.net/rowgroup/1.1.2/css/rowGroup.bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="{% static 'memberaudit/character_main.css' %}" type="text/css">
{% endblock extra_css %}

{% block extra_script %}
{% endblock extra_script %}